---
import type { AudioData } from '../lib/api';

interface Props {
  audio: AudioData;
  title?: string;
}

const { audio, title } = Astro.props;

function formatDuration(seconds?: number): string {
  if (!seconds) return '';
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}
---

<div class="px-4 py-6" data-testid="audio-player">
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
    {audio?.url ? (
      <div class="flex flex-col">
        <!-- Artwork and metadata -->
        {(audio.artwork || audio.title) && (
          <div class="flex items-center gap-4 p-4 bg-gray-50">
            {audio.artwork && (
              <img
                src={audio.artwork}
                alt={audio.title || 'Audio artwork'}
                class="w-16 h-16 rounded-lg object-cover flex-shrink-0"
                data-testid="audio-artwork"
              />
            )}
            <div class="flex-1 min-w-0">
              {audio.title && (
                <h3 class="font-semibold text-lg truncate" data-testid="audio-title">
                  {audio.title}
                </h3>
              )}
              {audio.duration && (
                <p class="text-sm text-gray-600" data-testid="audio-duration">
                  {formatDuration(audio.duration)}
                </p>
              )}
            </div>
          </div>
        )}
        
        <!-- Audio player controls -->
        <div class="p-4">
          <audio
            controls
            class="w-full"
            preload="metadata"
            data-testid="audio-element"
          >
            <source src={audio.url} type="audio/mpeg" />
            <source src={audio.url} type="audio/mp3" />
            <source src={audio.url} type="audio/ogg" />
            <source src={audio.url} type="audio/wav" />
            Your browser does not support the audio tag.
          </audio>
        </div>
      </div>
    ) : (
      <div class="p-4">
        <p class="text-gray-600">Audio source not available</p>
      </div>
    )}
  </div>
</div>
