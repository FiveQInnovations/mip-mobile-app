appId: com.fiveq.ffci
---
# Test prefetching performance
# This test verifies that Resources tab loads instantly (<100ms) after cache clear and app reload
# Expected: With prefetching, Resources should load instantly from prefetched cache
# Without prefetching, this test will fail (takes ~400ms)

- runFlow: _setup.yaml

# Verify homepage is loaded
- assertVisible:
    text: ".*(Resources|Chapters|Connect|Give|Home|About).*"
    optional: false

# Scroll to bottom to find dev tools button
- scroll
- scroll

# Clear cache using dev button
- tapOn:
    id: dev-clear-cache

# Wait for alert to appear
- waitForAnimationToEnd

# Dismiss alert
- tapOn:
    text: "OK"

# Wait for alert to dismiss
- waitForAnimationToEnd

# Reload app to trigger prefetching
- pressKey: Home
- waitForAnimationToEnd
- launchApp
- waitForAnimationToEnd

# Handle optional developer prompts
- tapOn:
    text: "Open"
    optional: true
- waitForAnimationToEnd

- tapOn:
    text: "Continue"
    optional: true
- waitForAnimationToEnd

# Wait for homepage to load (prefetching should happen here)
- assertVisible:
    text: ".*(Resources|Chapters|Connect|Give|Home|About).*"
    optional: false

# Wait a moment for prefetching to complete (prefetch happens in background)
- waitForAnimationToEnd
- waitForAnimationToEnd

# Navigate to Resources tab
- tapOn:
    text: "Resources"

# Verify Resources content loads INSTANTLY
# If prefetching works, content should be visible immediately (no loading spinner)
- assertVisible:
    text: ".*(Resources|Collection|Items|No items).*"
    optional: false

# Take screenshot for verification
- takeScreenshot: prefetch-performance-verification
